<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GTAC VCE101 Student Logbook</title>
<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Figtree', sans-serif;
        text-align: center;
        margin: 20px;
      }

      .sidebar {
        position: fixed;
        top: 40px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .sidebar button {
        padding: 10px;
        cursor: pointer;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        font-family: inherit;
      }
      .container {
        max-width: 800px;
        margin: 20px;
      }
      .investigation {
        margin-bottom: 50px;
      }
      .image-container {
        justify-content: center;
        align-items: center;
        max-width: 90%;
        height: auto;
        margin-top: 20px;
      }
      textarea {
        width: 100%;
        height: 100px;
        margin-top: 20px;
        font-family: inherit;
      }
      .custom-upload-btn {
  display: inline-block;
  background: #007bff;
  color: white;
  padding: 10px 18px;
  border-radius: 5px;
  cursor: pointer;
  font-family: inherit;
  font-size: 1em;
  margin-bottom: 10px;
  transition: background 0.2s;
}
.custom-upload-btn:hover {
  background: #0056b3;
}
.custom-upload-btn input[type="file"] {
  display: none;
}
table .image-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 180px;
  min-width: 180px;
  height: 180px;
  width: 100%;
  margin: 0 auto;
  box-sizing: border-box;
}
table .image-container img {
  max-width: 95%;
  max-height: 170px;
  width: auto;
  height: auto;
  display: block;
  margin: 0 auto;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  object-fit: contain;
}

      /* Collage styles */
      .collage {
        display: grid;
        gap: 12px;
        /* On wider screens force 4 columns so layout is exactly 4x3 for 12 images */
        grid-template-columns: repeat(4, 1fr);
        /* larger cells to give each photo more space */
        grid-auto-rows: 220px;
        align-items: stretch;
        margin: 20px auto;
        /* limit width so 4 columns are comfortable */
        max-width: 960px; /* 4 * ~220px columns */
      }
      /* Responsive fallback: on narrow screens, switch to auto-fit */
      @media (max-width: 900px) {
        .collage {
          grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
          grid-auto-rows: 150px;
          max-width: 100%;
        }
      }
      .collage-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        background: #f6f8fb;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: grab;
      }
      .collage-item.dragging { opacity: 0.5; }
      .collage-item.drag-over { outline: 3px dashed rgba(0,123,255,0.6); }
      .collage-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .collage-item.portrait img { object-fit: contain; }
      .collage-controls { margin-bottom: 8px; }

      
    </style>
  </head>

  <body>
    <div class="sidebar">
      
      <br /><br /><br />
      <img
        src="https://gtac.edu.au/wp-content/themes/gtac/assets/images/logo-2024.png"
        id="logoImage"
        style="width: 40%; opacity: 0.5"
      />
      <button onclick="scrollToSection('exp1')">Investigation 1</button>
      <button onclick="scrollToSection('exp2')">Investigation 2</button>
      <button onclick="printPageAsPDF()">Save as PDF</button>
    </div>

    <div class="container">
      <h1 style="text-align: center">
        VCE101 Inquiry into cell function using microscopy <br> Student Logbook </br>
      </h1>

      <h3>Enter Your Names:</h3>
      <textarea id="experiment1" placeholder="Type your names here"></textarea>
      <div id="exp1" class="experiment active">
        <h2 style="color: #4C34E5">Investigation 1: How do cells survive?</h2>
        
        
<b>Learning intention:  We will investigate cell structure and function using paramecium.</b>
<br>
<p style="text-align: left; font-weight: normal; margin-left: 2em;">
Success criteria: </p>
<ul style="text-align: left; font-weight: normal; margin-left: 1em;">
<li>I can follow a protocol to conduct a cell biology experiment.</li>
<li>I can use microscopy to investigate cells. </li></ul>
       <div style="margin-top: 20px;">

  <h2 style="color: #ff6d3a">Background information: Cells </h2>
<p> Match the cell organelles to its function and take a photo of the completed cell diagram here.</p>
    
      <div style="margin-top:12px; text-align:center;">
        <label class="custom-upload-btn">
          Upload photo of cell diagram here
          <input type="file" accept="image/*" onchange="addUploadedImage(event, 'singleUploadImg')" style="display:none;" />
        </label>
        <div id="singleUploadImg" class="image-container" style="margin-top:10px;"></div>
      </div>


      <h2 style="color: #00BC74">STEM Cycle of Inquiry</h2>
  
<img src="StemCycle.png" alt="GTAC STEM Cycle of Inquiry" style="max-width:70%; height:auto;">

        <h3 style="text-align: center; font-weight: normal;">Use the STEM Cycle of Inquiry to write an inquiry question about cell activity</h3>
      <h4 style="text-align: left; font-weight: bold; margin-left;">Write your inquiry question here: </h4>
      <textarea id="experiment2" placeholder="What type of cell activity would you like to see?"></textarea>    


  <h2 style="color: #ff6d3a">CONTROL SETUP: </h2>

<p> <strong>Prepare a control slide: </strong>Follow the protocol to set up your slide with paramecium.</p>

<img src="ProtocolControl.png" alt="Paramecium protocol" style="max-width:90%; height:auto;">

<h2 style="color: #ff6d3a">EXPERIMENTAL SETUP: </h2>
<p><strong>Your investigation:</strong> Choose a protocol that will help you answer your inquiry question</p>

<!-- Protocol Buttons Row -->
<div style="display: flex; justify-content: center; gap: 16px; margin: 18px 0;">
  <button class="protocol-btn" type="button" onclick="showProtocolImage('ProtocolStain.png', 'Protocol 1: Staining methods')">Protocol 1: Staining methods</button>
  <button class="protocol-btn" type="button" onclick="showProtocolImage('ProtocolOrganelle.png', 'Protocol 2: Observing Organelles')">Protocol 2: Observing Organelles</button>
  <button class="protocol-btn" type="button" onclick="showProtocolImage('ProtocolOrganisms.png', 'Protocol 3: Introducing other organisms')">Protocol 3: Introducing other organisms</button>
</div>


<h2> Results: </h2>
<p style="font-size: 1.2em; text-align: center;"> Upload images to compare your control slide to the experimental setup. </p>
<!-- Subtle 2x2 Table for Uploads -->
<div style="margin: 24px 0;">
  <table style="border-collapse: separate; border-spacing: 0; width: 100%; max-width: 100%; box-shadow: none; table-layout: fixed;">
    <tr>
  <td style="width:50%; text-align: center; font-weight: bold; background: #f8f8f8; padding: 10px 0; border-right: 2px solid #ccc;">Control slide</td>
  <td style="width:50%; text-align: center; font-weight: bold; background: #f8f8f8; padding: 10px 0;">Experiment slide</td>
    </tr>
    <tr>
  <td style="width:50%; text-align: center; border-right: 2px solid #ccc; padding: 18px 0;">
        <label class="custom-upload-btn">
          Upload image
          <input type="file" accept="image/*" onchange="addUploadedImage(event, 'controlSlideImg')" style="display:none;" />
        </label>
        <div id="controlSlideImg" class="image-container"></div>
      </td>
  <td style="width:50%; text-align: center; padding: 18px 0;">
        <label class="custom-upload-btn">
          Upload image
          <input type="file" accept="image/*" onchange="addUploadedImage(event, 'experimentSlideImg')" style="display:none;" />
        </label>
        <div id="experimentSlideImg" class="image-container"></div>
      </td>
    </tr>
  </table>
</div>




  <!-- Collage uploader and preview -->
      <section aria-labelledby="collageHeading" style="margin-top:18px; text-align:left;">
  <h2 id="collageHeading" style="color: #000000">Add additional photos of your experiment here (maximum 12 photos)</h2>
  <p style="margin-top:6px;">Upload up to 12 images to the photo collage. Drag images to reorder. </p>
  <div class="collage-controls">
          <label class="custom-upload-btn" id="collageUploadLabel">
            Add images to collage
            <input id="collageUploader" type="file" accept="image/*" multiple style="display:none;" />
          </label>
          <button id="clearCollageBtn" type="button" class="custom-upload-btn" style="background:#dc3545; margin-left:8px;">Clear Collage</button>
        </div>
        <div id="collage" class="collage" aria-live="polite"></div>
      </section>

      

<h3 style="color: #ff6d3a"> Conclusions: </h3>
<h3 style="text-align: left; font-weight: bold; margin-left: 1em;">Describe what you observed in your experimental setup and how it helped you answer your inquiry question.
</h3>
<textarea id="experiment3" placeholder="Answer your inquiry question here"></textarea>

      <div id="exp2" class="experiment">
        <h2 style="color: #4C34E5">Investigation 2: Using microscopy to diagnose disease</h2>
      
      <p style="text-align: left; font-weight: bold; margin-left: 1em;">Learning Intention: We are using microscopy to confirm diagnosis of disease.</b> </p>
       
      <p style="text-align: left; margin-left: 1em;">Success Criteria:</p>
      <li style="text-align: left; font-weight: normal; margin-left: 2em;"> I can form a hypothesis about cell structure and function. </li>
      <li style="text-align: left; font-weight: normal; margin-left: 2em;"> I can compare healthy and diseased cells to identify malfunctioning organelles.</li></ul>

        
<h3 style="color: #00BC74">Patient profiles  </h3>
      <h3 style="text-align: center; font-weight: normal;">Compare the patients' symptoms: </h3>

<img src="patientprofiles.png" alt="Patient profiles" style="max-width:90%; height:auto;">

      <h3 style="text-align: left; font-weight: bold; margin-left: 1em;">Form a hypothesis about which organelle(s) 
you think may be malfunctioning. </h3>
      <textarea id="experiment4" placeholder="We hypothesise that ______ is malfunctioning because..."></textarea>
      <br>

<img src="exp2overview.png" alt="How you will test your hypothesis" style="max-width: 90%; height:auto">

<h2 style="color: #00BC74"> Results:</h2>
<p> Upload a photo of the MEFs from the fluorescent microscope (EVOS) here:</p>


     <div style="margin: 24px 0;">
  <table style="border-collapse: separate; border-spacing: 0; width: 100%; max-width: 100%; box-shadow: none; table-layout: fixed;">
    <tr>
  <td style="width:50%; text-align: center; font-weight: bold; background: #f8f8f8; padding: 10px 0; border-right: 2px solid #ccc;">Healthy cells</td>
  <td style="width:50%; text-align: center; font-weight: bold; background: #f8f8f8; padding: 10px 0;">Diseased cells</td>
    </tr>
    <tr>
  <td style="width:50%; text-align: center; border-right: 2px solid #ccc; padding: 18px 0;">
        <label class="custom-upload-btn">
          Upload image of healthy cells here
          <input type="file" accept="image/*" onchange="addUploadedImage(event, 'controlSlideImg2')" style="display:none;" />
        </label>
        <div id="controlSlideImg2" class="image-container"></div>
      </td>
  <td style="width:50%; text-align: center; padding: 18px 0;">
        <label class="custom-upload-btn">
          Upload image of diseased cells here
          <input type="file" accept="image/*" onchange="addUploadedImage(event, 'experimentSlideImg2')" style="display:none;" />
        </label>
        <div id="experimentSlideImg2" class="image-container"></div>
      </td>
    </tr>
  </table>
</div>
<div id="protocolModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
  <div style="background:white; padding:24px; border-radius:10px; box-shadow:0 4px 16px rgba(0,0,0,0.2); text-align:center; position:relative; max-width:90vw; max-height:90vh;">
    <span style="position:absolute; top:10px; right:18px; font-size:24px; cursor:pointer;" onclick="closeProtocolModal()">&times;</span>
    <h2 id="protocolModalTitle" style="margin-bottom:12px;"></h2>
    <img id="protocolModalImg" src="" alt="Protocol" style="max-width:80vw; max-height:60vh; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08);">
  </div>
</div>

<h2 style="color: #00BC74"> Discussion: </h2>
      <h3 style="text-align: left; font-weight: bold; margin-left: 1em;"> Summarise what you observed from examination of the cell samples. </h3>
      <textarea id="experiment5" placeholder="Type your response here"></textarea>
      <br>

      Genetic samples were acquired and analysed at the protein-level. <br> Access the resource here <a href="https://gtacaus.github.io/vce101-mitochondria" target="_blank">Access VCE101 Mitochondria</a>
      <h3 style="text-align: left; font-weight: bold; margin-left: 1em;"> Outline what you have observed from genetic testing of the patients. </h3>
      <textarea id="experiment6" placeholder="Patient 1: ..."></textarea>
        
 
<h3 style="color: #00BC74"> Conclusions: </h3>
<h3 style="text-align: left; font-weight: bold; margin-left: 1em;">Summarise your diagnoses. </h3>
<textarea id="experiment7" placeholder="Type your conclusion(s) here"></textarea>

    <script>
    // Protocol Modal Logic
    function showProtocolImage(imgSrc, title) {
      var modal = document.getElementById('protocolModal');
      var img = document.getElementById('protocolModalImg');
      var modalTitle = document.getElementById('protocolModalTitle');
      img.src = imgSrc;
      img.alt = title;
      modalTitle.textContent = title;
      modal.style.display = 'flex';
    }
    function closeProtocolModal() {
      var modal = document.getElementById('protocolModal');
      modal.style.display = 'none';
      var img = document.getElementById('protocolModalImg');
      img.src = '';
      img.alt = '';
      document.getElementById('protocolModalTitle').textContent = '';
    }
      const TWELVE_HOURS = 12 * 60 * 60 * 1000;
      // ------------------------------------------------------------------------
      // Scroll to Section Function
      // ------------------------------------------------------------------------
      function scrollToSection(sectionId) {
        document
          .getElementById(sectionId)
          .scrollIntoView({ behavior: "smooth" });
      }

      const DB_NAME = "imageStore";
      const DB_VERSION = 1;
      const IMAGE_EXPIRY = 12 * 60 * 60 * 1000; // 12 hours in milliseconds

      // Open IndexedDB
      function openDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(DB_NAME, DB_VERSION);
          request.onupgradeneeded = function (event) {
            const db = event.target.result;
            if (!db.objectStoreNames.contains("images")) {
              db.createObjectStore("images", { keyPath: "id" });
            }
          };
          request.onsuccess = function (event) {
            resolve(event.target.result);
          };
          request.onerror = function (event) {
            reject("Error opening database:", event.target.error);
          };
        });
      }

      // Save Image to IndexedDB
      // Save Image to IndexedDB - returns a Promise resolving to the generated id
      function saveImageToDB(containerId, imageData) {
        return openDB().then((db) => new Promise((resolve, reject) => {
          const transaction = db.transaction("images", "readwrite");
          const store = transaction.objectStore("images");

          // Generate a unique key for each image
          const uniqueId = containerId + "_" + Date.now() + "_" + Math.random().toString(36).slice(2,7);

          const imageEntry = {
            id: uniqueId, // Unique key
            containerId: containerId,
            image: imageData,
            timestamp: Date.now(),
          };

          const req = store.put(imageEntry);
          req.onsuccess = function () { resolve(uniqueId); };
          req.onerror = function (e) { console.error('saveImageToDB put failed', e); reject(e); };
        })).catch(e => { console.error('saveImageToDB failed', e); throw e; });
      }

      // Retrieve and Restore Images from IndexedDB
      function restoreImagesFromDB() {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readonly");
          const store = transaction.objectStore("images");
          const request = store.getAll();

          request.onsuccess = function () {
            const images = request.result;
            const currentTime = Date.now();

            images.forEach((imageEntry) => {
              // If this entry is a collage (stores an array), always restore it so collage persists
              if (imageEntry && Array.isArray(imageEntry.collage)) {
                try { renderCollage(imageEntry.collage); } catch (e) { console.warn('renderCollage missing', e); }
                return;
              }

              // Otherwise expect a single image entry with containerId and image (subject to expiry)
              if (imageEntry && imageEntry.image && imageEntry.containerId) {
                if (currentTime - imageEntry.timestamp <= IMAGE_EXPIRY) {
                  displayImage(imageEntry.image, imageEntry.containerId);
                } else {
                  removeImageFromDB(imageEntry.id);
                }
              }
            });
          };
        });
      }

      // Remove Image from IndexedDB
      function removeImageFromDB(containerId) {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readwrite");
          const store = transaction.objectStore("images");
          store.delete(containerId);
        });
      }

      // Function to Display Image in its Container
      // displayImage accepts an optional imageId to attach as data attribute
      function displayImage(imageData, containerId, imageId) {
        const container = document.getElementById(containerId);
        if (container) {
          // Only clear if it is NOT container 3
          if (containerId !== "imageContainer3") {
            container.innerHTML = "";
          }

          const image = document.createElement("img");
          image.src = imageData;
          image.style.maxWidth = "100%";
          if (imageId) {
            image.dataset.imageId = imageId; // e.g. "imageContainer1_170..."
            try { image.id = imageId; } catch (e) { /* ignore invalid id char errors */ }
          }
          container.appendChild(image);
        }
      }

      // ---------------- Collage support ----------------
      const COLLAGE_KEY = 'collage_images'; // key in IndexedDB store
  const MAX_COLLAGE = 12;

      // Save collage array (ordered) to IndexedDB as a single record
      function saveCollageToDB(collageArray) {
        openDB().then(db => {
          const tx = db.transaction('images', 'readwrite');
          const store = tx.objectStore('images');
          const id = COLLAGE_KEY;
          const entry = { id: id, collage: collageArray, timestamp: Date.now() };
          store.put(entry);
        }).catch(e => console.error('DB save collage failed', e));
      }

      // Load collage record from DB
      function loadCollageFromDB() {
        return openDB().then(db => new Promise((resolve, reject) => {
          const tx = db.transaction('images', 'readonly');
          const store = tx.objectStore('images');
          const req = store.get(COLLAGE_KEY);
          req.onsuccess = () => resolve(req.result ? req.result.collage : null);
          req.onerror = () => reject(req.error);
        }));
      }

      // Render collage array (each item: {id, dataURL})
      function renderCollage(collageArray) {
        const grid = document.getElementById('collage');
        grid.innerHTML = '';
        if (!collageArray || collageArray.length === 0) return;

        collageArray.forEach((item, index) => {
          const cell = document.createElement('div');
          cell.className = 'collage-item';
          cell.draggable = true;
          cell.dataset.index = index;

          const img = document.createElement('img');
          img.src = item.data;
          img.alt = `Photo ${index+1}`;
          // attach the stored identifier so it's visible in DOM
          if (item.id) img.dataset.imageId = item.id;

          // detect orientation after image loads
          img.onload = function() {
            const isPortrait = img.naturalHeight > img.naturalWidth;
            if (isPortrait) cell.classList.add('portrait');
          };

          cell.appendChild(img);

          // drag events
          cell.addEventListener('dragstart', (e) => {
            cell.classList.add('dragging');
            e.dataTransfer.setData('text/plain', index);
            e.dataTransfer.effectAllowed = 'move';
          });
          cell.addEventListener('dragend', () => cell.classList.remove('dragging'));

          cell.addEventListener('dragover', (e) => {
            e.preventDefault();
            cell.classList.add('drag-over');
          });
          cell.addEventListener('dragleave', () => cell.classList.remove('drag-over'));
          cell.addEventListener('drop', (e) => {
            e.preventDefault();
            cell.classList.remove('drag-over');
            const fromIndex = Number(e.dataTransfer.getData('text/plain'));
            const toIndex = Number(cell.dataset.index);
            if (!Number.isNaN(fromIndex)) {
              const newArr = Array.from(collageArray);
              const [moved] = newArr.splice(fromIndex,1);
              newArr.splice(toIndex,0,moved);
              // re-render and save
              renderCollage(newArr);
              saveCollageToDB(newArr);
            }
          });

          grid.appendChild(cell);
        });
      }

      // Handle adding files to collage
      document.getElementById('collageUploader').addEventListener('change', function(e){
        const files = Array.from(e.target.files || []);
        if (!files.length) return;

        loadCollageFromDB().then(existing => {
          const collage = existing ? existing.slice() : [];
          const space = MAX_COLLAGE - collage.length;
          if (files.length > space) {
            alert(`You can only add ${space} more image(s) to reach the maximum of ${MAX_COLLAGE}.`);
          }
          const toTake = files.slice(0, space);
          let processed = 0;
          toTake.forEach(file => {
            const reader = new FileReader();
            reader.onload = (ev) => {
              // create a stable id for the collage item
              const itemId = Date.now() + '_' + Math.random().toString(36).slice(2,7);
              collage.push({ id: itemId, data: ev.target.result });
              processed++;
              if (processed === toTake.length) {
                renderCollage(collage);
                saveCollageToDB(collage);
              }
            };
            reader.readAsDataURL(file);
          });
        }).catch(err => {
          console.error('Load collage failed', err);
        });
        // reset input
        e.target.value = '';
      });

      // Clear collage (robust handler)
      // Attach on DOMContentLoaded to ensure the button exists and add debug logs
      document.addEventListener('DOMContentLoaded', function () {
        console.log('[debug] DOMContentLoaded: attaching clearCollage handler');
        const btn = document.getElementById('clearCollageBtn');
        if (!btn) { console.warn('clearCollageBtn not found'); return; }

        async function clearCollage() {
          console.log('[debug] clearCollage invoked');
          if (!confirm('Clear all images from the collage?')) return;
          btn.disabled = true;
          try {
            const db = await openDB();
            const tx = db.transaction('images', 'readwrite');
            const store = tx.objectStore('images');
            const entry = { id: COLLAGE_KEY, collage: [], timestamp: Date.now() };
            const req = store.put(entry);
            req.onsuccess = function() {
              console.log('Collage record cleared (put empty array)');
              try { renderCollage([]); } catch (e) { console.warn('renderCollage failed', e); }
              alert('Collage cleared');
            };
            req.onerror = function(e) {
              console.error('Failed to write empty collage record', e);
              try { renderCollage([]); } catch (e) { console.warn('renderCollage failed', e); }
              alert('Collage cleared (UI only). See console for DB error.');
            };
            tx.oncomplete = function() { btn.disabled = false; };
            tx.onerror = function(e) { console.error('Transaction error clearing collage', e); btn.disabled = false; };
          } catch (err) {
            console.error('Error clearing collage', err);
            try { renderCollage([]); } catch (e) { console.warn('renderCollage failed', e); }
            alert('Error clearing collage (UI cleared). See console for details.');
            btn.disabled = false;
          }
        }

        // Remove any existing listener to avoid duplicates then attach
        try { btn.removeEventListener('click', clearCollage); } catch (e) { /* ignore */ }
        btn.addEventListener('click', clearCollage);
      });

      // When page loads, restore collage
      document.addEventListener('DOMContentLoaded', function(){
        loadCollageFromDB().then(collage => {
          if (Array.isArray(collage)) renderCollage(collage);
        }).catch(e => console.error('Restore collage failed', e));
      });

      // Modified Upload Image Function to Store in IndexedDB
        function addUploadedImage(event, containerId) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const imageData = e.target.result;
              // Save image and get back the generated id, then display with that id
              saveImageToDB(containerId, imageData).then((generatedId) => {
                displayImage(imageData, containerId, generatedId);
              }).catch((err) => {
                // On failure still display (no id)
                console.warn('saveImageToDB failed, displaying without id', err);
                displayImage(imageData, containerId, null);
              });
            };
            reader.readAsDataURL(file);
          }
        }

      // Restore Images on Page Load
      document.addEventListener("DOMContentLoaded", function () {
        restoreImagesFromDB();
      });

      // ------------------------------------------------------------------------
      // Print Page as PDF
      // ------------------------------------------------------------------------
      function printPageAsPDF() {
        window.print();
      }

      // ------------------------------------------------------------------------
      // Save and Restore (Session and Local Storage)
      // ------------------------------------------------------------------------
      document.addEventListener("DOMContentLoaded", function () {
        // Restore text areas from Session Storage on page load
        document.querySelectorAll("textarea").forEach((textarea) => {
          const savedText = sessionStorage.getItem(textarea.id);
          if (savedText !== null) {
            textarea.value = savedText;
          }
          // Save changes to both Session Storage and Local Storage
          textarea.addEventListener("input", () => {
            sessionStorage.setItem(textarea.id, textarea.value);
            // Local Storage now includes a timestamp
            const dataToStore = {
              value: textarea.value,
              timestamp: Date.now(),
            };
            localStorage.setItem(textarea.id, JSON.stringify(dataToStore));
          });
        });

        // Restore editable table cells from Session Storage on page load
        const editableCells = document.querySelectorAll(
          "td[contenteditable=true]"
        );
        editableCells.forEach((cell, index) => {
          const savedCellText = sessionStorage.getItem(`cell-${index}`);
          if (savedCellText !== null) {
            cell.innerText = savedCellText;
          }
          // Save changes to both Session Storage and Local Storage
          cell.addEventListener("input", () => {
            sessionStorage.setItem(`cell-${index}`, cell.innerText);
            // Save to Local Storage with timestamp
            const dataToStore = {
              value: cell.innerText,
              timestamp: Date.now(),
            };
            localStorage.setItem(`cell-${index}`, JSON.stringify(dataToStore));
          });
        });

        // Restore the uploaded image from Session Storage if desired (not strictly required, but included here)
        const uploadedImage = document.getElementById("uploadedImage");
        if (uploadedImage) {
          const savedImageData = sessionStorage.getItem("uploadedImage");
          if (savedImageData) {
            uploadedImage.src = savedImageData;
            uploadedImage.style.display = "block";
          }
        }
      });

      // ------------------------------------------------------------------------
      // Triple Click Detection for Logo
      // ------------------------------------------------------------------------
      let clickCount = 0;
      let firstClickTime = 0;

      document
        .getElementById("logoImage")
        .addEventListener("click", detectTripleClick);

      function detectTripleClick() {
        const currentTime = new Date().getTime();

        // If no clicks yet, initialize
        if (clickCount === 0) {
          clickCount = 1;
          firstClickTime = currentTime;
        } else {
          // If current time is still within 1 second of the first click
          if (currentTime - firstClickTime <= 1000) {
            clickCount++;
            // If we reach 3 clicks within 1 second, prompt for password
            if (clickCount === 3) {
              promptForPassword();
              // Reset click counter and time
              clickCount = 0;
              firstClickTime = 0;
            }
          } else {
            // More than 1 second has passed since the first click,
            // so reset and start over
            clickCount = 1;
            firstClickTime = currentTime;
          }
        }
      }

      // ------------------------------------------------------------------------
      // Prompt for Password
      // ------------------------------------------------------------------------
      function promptForPassword() {
        const userPassword = prompt("Please enter the password:");
        if (userPassword === "Abc") {
          showOverlay();
        }
      }

      function showOverlay() {
        document.getElementById("passwordOverlay").style.display = "flex";
      }

      function closeOverlay() {
        document.getElementById("passwordOverlay").style.display = "none";
      }

      function restoreLocalStorageData() {
        // Restore text areas from Local Storage
        document.querySelectorAll("textarea").forEach((textarea) => {
          const storedJson = localStorage.getItem(textarea.id);
          if (storedJson) {
            try {
              const parsed = JSON.parse(storedJson);
              if (Date.now() - parsed.timestamp <= TWELVE_HOURS) {
                // If it's less than 12 hours old, restore the value
                textarea.value = parsed.value;
              } else {
                // Otherwise, ignore or remove the stale data
                console.log(
                  `Data for ${textarea.id} is older than 12 hours; not restoring.`
                );
                // Optionally remove from Local Storage:
                // localStorage.removeItem(textarea.id);
              }
            } catch (e) {
              console.warn(
                `Invalid JSON in localStorage for ${textarea.id}`,
                e
              );
            }
          }
        });

        // Restore table cells from Local Storage
        document
          .querySelectorAll("td[contenteditable=true]")
          .forEach((cell, index) => {
            const storedJson = localStorage.getItem(`cell-${index}`);
            if (storedJson) {
              try {
                const parsed = JSON.parse(storedJson);
                if (Date.now() - parsed.timestamp <= TWELVE_HOURS) {
                  cell.innerText = parsed.value;
                } else {
                  console.log(
                    `Data for cell-${index} is older than 12 hours; not restoring.`
                  );
                  // localStorage.removeItem(`cell-${index}`);
                }
              } catch (e) {
                console.warn(
                  `Invalid JSON in localStorage for cell-${index}`,
                  e
                );
              }
            }
          });

        // Close the overlay as before
        closeOverlay();
      }
      // Function to restore a static image to the specified container
      function restoreImage(containerId, imageSrc) {
        const container = document.getElementById(containerId);
        if (container) {
          const image = document.createElement("img");
          image.src = imageSrc; // Path to the static image
          image.style.maxWidth = "100%";
          container.innerHTML = ""; // Clear any previous content
          container.appendChild(image);
        } else {
          console.error(`Container ${containerId} not found.`);
        }
      }

      // Function to Clear All Images from IndexedDB and UI
      function clearAllImages() {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readwrite");
          const store = transaction.objectStore("images");
          store.clear(); // Clears all images from IndexedDB

          // Remove images from UI
          const imageContainers = [
            "imageContainer1",
            "imageContainer2",
            "imageContainer3",
            "imageContainer4",
            "imageContainer5",
            "imageContainer6",

          ];

          imageContainers.forEach((containerId) => {
            const container = document.getElementById(containerId);
            if (container) {
              container.innerHTML = ""; // Clears the image display
            }
          });

          alert("All stored images have been cleared!");
        });
      }
    </script>
    <!-- Overlay for Password-Protected Actions -->
    <div id="passwordOverlay" class="overlay">
      <div class="overlay-content">
        <span class="close-btn" onclick="closeOverlay()">&times;</span>
        <h2>Restore Panel</h2>
        <p>Click a button below to place example images or restore data.</p>

        <button onclick="restoreImage('singleUploadImg', 'celldiagramexample.png')">
          Cell diagram model
        </button>
        <button onclick="restoreImage('controlSlideImg', '1_paramecium_P8120005.JPG')">
          Control slide example
        </button>
        <button onclick="restoreImage('experimentSlideImg', '2_paramecium_yeast1vac.jpg')">  
          Experimental slide example
        </button>
        <button onclick="restoreImage('imageContainer4', 'A1_fluoro400x.JPG')">
          Healthy MEF example
        </button>
        <button onclick="restoreImage('imageContainer5', 'fluoro stain1_gtac.jpg')">
          Diseased MEF example
        </button>        
        <button onclick="restoreImage('imageContainer6', 'Klinefelter2.jpg')">
          Growth plates
        </button>

        <button onclick="clearAllImages()">
          Clear All Images (DANGER-CANNOT UNDO)
        </button>

        <hr />
        <button onclick="restoreLocalStorageData()">Restore Data</button>
      </div>
    </div>

    <style>
    .protocol-btn {
      background: #00bc74;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 18px;
      font-family: inherit;
      font-size: 1em;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background 0.2s;
      outline: none;
      box-shadow: none;
    }
    .protocol-btn:hover {
      background: #009e5f;
    }
      /* Overlay Styling */
      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .overlay-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
        width: 300px;
        position: relative;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        cursor: pointer;
      }

      .overlay button {
        display: block;
        width: 100%;
        background: #007bff;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
      }

      .overlay hr {
        margin: 15px 0;
      }
      @media print {
  .sidebar {
    display: none !important;
  }
}
     
    </style>
  </body>
</html>
